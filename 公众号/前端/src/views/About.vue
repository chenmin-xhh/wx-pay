<template>
  <div class="about">
    <div class="mine">
      <div style="background-color: rgb(208,146,132);">
        <div class="profilephoto">
          <div>
            <div
              class="theaccount"
              style="position: absolute; z-index: 2; padding: 4px 12px; right: 0px; margin-top: -17px;  margin-right: 15px;">登出帐号</div>
          </div>
          <div>
            <div class="headportrait">
              <img
                :src="user.cover"
                width="75.9px"
                height="75.9px"
                style="border-radius: 50%;  display: block;"
              />
            </div>
          </div>
          <div class="compellation">{{user.nickname}}</div>
        </div>
        <div>
          <div class="navigationbar">
            <div class="avigatin">
              <div>
                <svg width="15px" height="18.5px" viewBox="0 0 30 37" version="1.1">
                  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                    <g
                      id="Artboard-Copy-29"
                      transform="translate(-455.000000, -554.000000)"
                      fill-rule="nonzero"
                      fill="#FFFFFF"
                    >
                      <g id="Group-6" transform="translate(0.000000, 520.000000)">
                        <path
                          d="M459.409917,34 C456.980519,34 455,36.0013893 455,38.4468507 L455,66.5669134 C455,69.0074612 456.982079,70.999911 459.409917,70.999911 L484.105455,70.999911 C484.42353,71.0044329 484.719387,70.8364439 484.879737,70.5602703 C485.040088,70.2840968 485.040088,69.9425261 484.879737,69.6663526 C484.719387,69.390179 484.42353,69.22219 484.105455,69.2267119 L459.409917,69.2267119 C457.928805,69.2267119 456.763967,68.0557817 456.763967,66.5669134 L456.763967,66.275998 C456.78223,66.2265406 456.796066,66.1755436 456.80531,66.1236137 C457.012242,64.8589805 458.078952,63.9071149 459.409917,63.9071149 L484.105455,63.9071149 C484.592541,63.9070659 484.98739,63.5101505 484.987438,63.0205154 L484.987438,34.8865995 C484.98739,34.3969644 484.592541,34.000049 484.105455,34 L459.409917,34 Z M459.409917,35.773199 L483.223471,35.773199 L483.223471,62.1339159 L459.409917,62.1339159 C458.411934,62.1339159 457.505062,62.4973512 456.763967,63.0620747 L456.763967,38.4468507 C456.763967,36.9499409 457.930365,35.773199 459.409917,35.773199 Z M459.327231,65.6803139 C459.012084,65.6951003 458.728731,65.8777943 458.583933,66.1595609 C458.439136,66.4413274 458.454898,66.7793476 458.625281,67.0462628 C458.795664,67.3131779 459.094776,67.468426 459.409917,67.4535129 L484.105455,67.4535129 C484.42353,67.4580348 484.719387,67.2900459 484.879737,67.0138723 C485.040088,66.7376987 485.040088,66.3961281 484.879737,66.1199545 C484.719387,65.843781 484.42353,65.675792 484.105455,65.6803139 L459.409917,65.6803139 C459.382371,65.6790146 459.354778,65.6790146 459.327231,65.6803139 Z"
                          id="Shape"
                        />
                      </g>
                    </g>
                  </g>
                </svg>
              </div>
              <div class="typeface">订单生成</div>
            </div>
          </div>
        </div>
      </div>
      <div>

      </div>
      <div id="nav">
        <router-link to="/">
          <div class="router">
            <svg viewBox="0 0 46 46" class="Nav-svg">
              <path
                d="M40.408626,19.0936037 C41.5142794,19.0936037 41.7818872,18.4605103 40.999899,17.6798584 C40.999899,17.6798584 40.2374609,16.8932902 39.3786323,16.1092182 L28.307135,6.00143742 C25.3835998,3.33238081 20.5250347,3.33332761 17.6025366,6.00143742 L6.53103934,16.1092182 C5.27063301,17.2599127 4.94536401,17.5976819 4.94536401,17.5976819 C4.15404803,18.3630748 4.40272061,18.9835484 5.51069352,18.9835484 L8.12933604,18.9835484 L8.12933604,38.9782179 C8.12933604,40.6506196 9.44018899,42 11.0589093,42 L15.1960178,42 L15.1960178,36.1142596 C15.1960178,33.3521692 17.3690855,31.1184079 20.0602903,31.1184079 L25.9028188,31.1184079 C28.5876179,31.1184079 30.7670913,33.3503112 30.7670913,36.1142596 L30.7670913,42 L34.4156598,42 C36.0394895,42 37.3452331,40.6533202 37.3452331,38.9782179 L37.3452331,19.0936037 L40.408626,19.0936037 Z M28.9248518,45 L17.5567028,45 L11.0589093,45 C7.82972191,45 5.21194826,42.3082595 5.21194826,38.9782179 L5.21194826,21.9835484 C-0.845715653,22.0536625 0.249139206,17.8325867 4.5941418,13.8657941 L15.665639,3.75801332 C19.6913513,0.0827185006 26.2138163,0.0786065279 30.2440326,3.75801332 L41.3155298,13.8657941 C45.7999206,17.9598419 47.0068349,21.9607063 40.2626209,22.0536625 L40.2626209,38.9782179 C40.2626209,42.3039563 37.6567593,45 34.4156598,45 L28.9248518,45 Z M27.8497036,42 L27.8497036,36.1142596 C27.8497036,35.0088943 26.9780536,34.1184079 25.9028188,34.1184079 L20.0602903,34.1184079 C18.9774371,34.1184079 18.1134056,35.0119812 18.1134056,36.1142596 L18.1134056,42 L27.8497036,42 Z"
              />
            </svg>
            <div class="router-text">首页</div>
          </div>
        </router-link>

        <router-link to="/Rules">
          <div class="router">
            <svg viewBox="0 0 46 46" class="Nav-svg">
              <path
                d="M5.13634582,14.9000848 C4.99035474,14.4862269 4.60514195,12.5971561 3.75482474,7.77983331 C2.83501781,3.52910793 4.43253177,0.5 8.76864821,0.5 L20.2546528,0.5 C21.0831633,0.5 21.7548039,1.17157288 21.7548039,2 C21.7548039,2.82842712 21.0831633,3.5 20.2546528,3.5 L8.76864821,3.5 C6.67624454,3.5 6.12473309,4.54574216 6.69830817,7.2015831 C6.81046467,7.83616231 6.91540462,8.42422373 7.01338927,8.96769281 C8.25306859,7.72925282 10.0046811,6.97740113 12.0370705,6.97740113 L33.2099771,6.97740113 C37.6256869,6.97740113 40.715656,10.5215446 40.1103966,14.9022962 L38.5838965,25.9508111 C37.9791832,30.3276098 33.9027269,33.8757062 29.4825248,33.8757062 L15.7645229,33.8757062 C11.3426874,33.8757062 7.26841058,30.3315627 6.66315116,25.9508111 L5.13665105,14.9022962 C5.1365492,14.901559 5.13644746,14.9008219 5.13634582,14.9000848 Z M10.5160122,46.5 C7.63321442,46.5 5.29950051,44.1540314 5.29950051,41.2641243 C5.29950051,38.3742171 7.63321442,36.0282486 10.5160122,36.0282486 C13.3988099,36.0282486 15.7325238,38.3742171 15.7325238,41.2641243 C15.7325238,44.1540314 13.3988099,46.5 10.5160122,46.5 Z M10.5160122,43.5 C11.738193,43.5 12.7322217,42.5007515 12.7322217,41.2641243 C12.7322217,40.0274971 11.738193,39.0282486 10.5160122,39.0282486 C9.29383135,39.0282486 8.29980262,40.0274971 8.29980262,41.2641243 C8.29980262,42.5007515 9.29383135,43.5 10.5160122,43.5 Z M36.2175797,46.5 C33.334782,46.5 31.0010681,44.1540314 31.0010681,41.2641243 C31.0010681,38.3742171 33.334782,36.0282486 36.2175797,36.0282486 C39.1003775,36.0282486 41.4340914,38.3742171 41.4340914,41.2641243 C41.4340914,44.1540314 39.1003775,46.5 36.2175797,46.5 Z M36.2175797,43.5 C37.4397606,43.5 38.4337893,42.5007515 38.4337893,41.2641243 C38.4337893,40.0274971 37.4397606,39.0282486 36.2175797,39.0282486 C34.9953989,39.0282486 34.0013702,40.0274971 34.0013702,41.2641243 C34.0013702,42.5007515 34.9953989,43.5 36.2175797,43.5 Z M9.63522588,25.540262 C10.0351674,28.434962 12.839098,30.8757062 15.7645229,30.8757062 L29.4825248,30.8757062 C32.4053871,30.8757062 35.2122993,28.4319287 35.6118218,25.540262 L37.1383219,14.491747 C37.4943309,11.9150223 35.8065182,9.97740113 33.2099771,9.97740113 L12.0370705,9.97740113 C9.44255541,9.97740113 7.75307191,11.9175926 8.10872577,14.491747 L9.63522588,25.540262 Z"
              />
            </svg>
            <div class="router-text">购物车</div>
          </div>
        </router-link>
        <router-link to="/order">
          <div class="router">
            <svg viewBox="0 0 46 46" class="Nav-svg">
              <path
                d="M19,45 L7.00532266,45 C3.67643992,45 1,42.3124666 1,38.9972261 L1,7.00277388 C1,3.68616253 3.68867454,1 7.00532266,1 L19,1 L38.9944332,1 C42.3074511,1 44.9946773,3.68753341 44.9946773,7.00277388 L44.9946773,38.9972261 C44.9946773,42.3138375 42.3082765,45 38.9944332,45 L19,45 Z M6.99467734,4.00001841 C5.33892147,4.00574691 4,5.34742752 4,7.00277388 L4,38.9972261 C4,40.6569606 5.33248781,41.994294 6.99467734,41.9999818 L6.99467734,4.00001709 Z M9.99467734,42 L38.9944332,42 C40.6517185,42 41.9946773,40.6566869 41.9946773,38.9972261 L41.9946773,7.00277388 C41.9946773,5.34445361 40.6506626,4 38.9944332,4 L9.99467734,4 L9.99467734,42 Z M15.9946773,11.0085302 C15.9946773,9.8992496 16.8928897,9 17.9854725,9 L34.0038822,9 C35.103368,9 35.9946773,9.90195036 35.9946773,11.0085302 L35.9946773,18.9914698 C35.9946773,20.1007504 35.096465,21 34.0038822,21 L17.9854725,21 C16.8859867,21 15.9946773,20.0980496 15.9946773,18.9914698 L15.9946773,11.0085302 Z M18.9946773,18 L32.9946773,18 L32.9946773,12 L18.9946773,12 L18.9946773,18 Z"
              />
            </svg>
            <div class="router-text">订单</div>
           
          </div>
        </router-link>
        <router-link to="/about">
          <div class="router">
            <svg viewBox="0 0 46 46" class="Nav-svg">
              <path
                d="M11.6315789,12.2340426 C11.6315789,6.02965217 16.7213944,1 23,1 C29.2786056,1 34.3684211,6.02965217 34.3684211,12.2340426 C34.3684211,14.606682 33.624088,16.807528 32.3535828,18.6209987 C31.9895904,19.1405475 30.4160066,20.7629038 30.0271608,21.0654554 C30.5085498,21.1734693 32.4831837,21.786603 33.2739699,22.1670846 C37.8735453,24.3077079 41,28.5097261 41,33.3461158 L41,41.0382649 C41,43.2262708 39.2147544,45 36.9924916,45 L9.0075084,45 C6.79422262,45 5,43.2300258 5,41.0382649 L5,33.3461158 C5,28.510965 8.12452331,24.3075795 12.7255583,22.1666081 C13.2504333,21.9223712 15.4911714,21.1731971 15.9725564,21.0652353 C15.5837584,20.7627014 14.2475509,19.4541476 13.6461576,18.6206281 C12.3758106,16.8072282 11.6315789,14.6065204 11.6315789,12.2340426 Z M16.6375368,23.9605999 C11.5267967,25.1068021 8.00451128,28.9924967 8.00451128,33.3461158 L8.00451128,41.0382649 C8.00451128,41.5888298 8.45208633,42.031003 9.0075084,42.031003 L36.9924916,42.031003 C37.5509942,42.031003 37.9954887,41.5909045 37.9954887,41.0382649 L37.9954887,33.3461158 C37.9954887,28.9928112 34.4721141,25.1073846 29.3618806,23.9607527 L23.2204185,22.5827343 L28.1684742,18.732771 C30.1738544,17.1724329 31.3639098,14.8031405 31.3639098,12.2340426 C31.3639098,7.66938392 27.6192598,3.96899696 23,3.96899696 C18.3807402,3.96899696 14.6360902,7.66938392 14.6360902,12.2340426 C14.6360902,14.8030485 15.8260593,17.1722646 17.8313174,18.7326089 L22.779701,22.583077 L16.6375368,23.9605999 Z"
              />
            </svg>
            <div class="router-text">我的</div>
          </div>
        </router-link>
      </div>
      <div class="wrapper">
      <div v-for="o in orders" :key="o.id">
          <div class="content">
            <div class="title">订单编号：{{o.id}}
            <span>订单状态：{{states[o.state]}}</span>
            </div>
            <div class="price">价格：0.01</div>
            <div>
            <span class="btn" v-if="o.state==1" @click="refund(o)">取消订单</span>
            <span class="btn" v-if="o.state==0" @click="createOrder(o)">支付订单</span>
            </div>
          </div>
      </div>
    </div>
    </div>

  </div>
</template>
<script>
export default {
  name: "mine",
  data() {
    return {
      orders: [],
      user:{},
      states:["未支付", "已支付", "已退款"]
    };
  },
  async created() {
    window.console.log(this.$route);
    //获取url的code
    let code = this.$route.query.code;
    if(code){
      console.info(code);
      await this.login(code);
    }else {
      this.addOrder();      
    }
  },

  methods: {
    login(code) {
      this.$http.get("/users/login?code="+code).then(res => {
        this.user = res.data.data;
        console.info(res.data.data);
        console.info(res.data.data.uuid);
        localStorage.setItem("token",res.data.data.unionid);
        this.addOrder();
      });
    },
    addOrder(){
      this.$http.get("/orders").then(res =>{
        this.orders = res.data;
      })
    },
    createOrder(order){
      this.$http.post("/pay", order).then(res => {
        if(res.data.code != 200) return;
        //调起微信支付
        WeixinJSBridge.invoke(
          'getBrandWCPayRequest', res.data.data,
          (res) => {
            if (res.err_msg == "get_brand_wcpay_request:ok") {
              window.setTimeout(() => {this.addOrder()},3000);
            }
          });
        window.console.log(res.data.data);
      })
    },
    refund(order){
      this.$http.post("/pay/refund",{id:order.id}).then(res =>{
          window.setTimeout(() => {this.addOrder()},7000);
      })
    }
  }
};
</script>


<style>
.wrapper{
    margin-bottom: 60px;
}
.content{
  margin: 5px;
  border: 1px black solid;
  border-radius: 8px;
}
.title{
  display: flex;
  flex:1;
  justify-content: space-between;
}
.price{
  border-top:1px solid rgba(0, 0, 0, 0.2);
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
}
.btn{
  border:1px solid gray;
  border-radius: 5px;
}
.profilephoto {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 32px 0px 19px;
}
.avigatin {
  text-align: center;
  flex: 1 0 9%;
}
.avigatin a {
  text-decoration: none;
  color: #ffff;
}
.theaccount {
  border-radius: 22px;
  border: 0.5px solid rgb(242, 242, 242);
  color: #ffff;
  position: absolute;
  z-index: 2;
  margin: 15px;
  padding: 4px 1px;
  right: 0px;
  font-size: 12px;
  font-weight: 400;
  margin-top: -20px;
}
.headportrait {
  width: 76px;
  height: 76px;
  border-radius: 50%;
  box-shadow: rgba(0, 0, 0, 0.2) 0px 0px 8px 0px;
  border-width: 2px;
  border-style: solid;
  border-color: rgb(255, 255, 255);
  border-image: initial;
}
.compellation {
  font-size: 20px;
  font-weight: 400;
  margin: 8px 15px;
  color: #ffffff;
}
.navigationbar {
  display: flex;
  justify-content: space-around;
  align-items: center;
  height: 72px;
  margin-left: 2px;
  color: rgb(255, 255, 255);
  border-top: 0.5px solid rgba(255, 255, 255, 0.6);
  border-bottom: 0.5px solid rgba(255, 255, 255, 0.6);
}
.typeface {
  color: #ffffff;
  font-size: 15px;
  font-weight: 100;
}
.but {
  color: #fff;
}

.typefaces {
  color: #ffffff;
}
.dynamicbookshel {
  display: flex;
  align-items: center;
  justify-content: space-around;
  height: 56px;
  font-size: 16px;
}
#nav {
  position: fixed;
  bottom: 0px;
  height: 50px;
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 2;
}

#nav a {
  flex: 1;
  font-weight: bold;
  color: #333333;
  font-size: 12px;
  text-decoration: none;
}
#nav svg {
  width: 23px;
  height: 23px;
}

#nav a.router-link-exact-active {
  color: rgb(24, 195, 170);
  fill: rgb(24, 195, 170);
}

.router {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 50px;
  border-top: solid 1px #f2f2f2;
  background-color: #fff;
}
.count {
  position: absolute;
  top: -3px;
  left: 50%;
  margin-left: 5px;
  box-sizing: border-box;
  height: 18px;
  color: #fff;
  font-size: 12px;
  font-weight: 400;
  line-height: 18px;
  text-align: center;
  background: rgb(242, 129, 129);
  border-radius: 9px;
  transition: transform 0.2s;
  transform-origin: center;
  padding: 0 0.66em;
}
.router-text {
  font-size: 12px;
  margin-top: 3.5px;
  font-weight: 300;
}
</style>
